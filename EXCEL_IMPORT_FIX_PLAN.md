# План исправления импорта Excel

## Выявленные проблемы

### 1. **Проблема определения строк категорий**
- **Симптом**: Строки категорий (5, 9, 14, 19) не определяются правильно
- **Причина**: Колонки A, B, C могут быть обрезаны в Excel, поэтому полное сравнение `a === b === c` не работает
- **Пример**: Строка 5: A="1. СТК (свободная танцевальная категория) (начинающие) Форме", B="1. СТК (свободная танцевальная категория) (начинаю", C="1. СТК (свободная танцевальная категория"
- **Решение**: Проверять начало строк (первые 50-100 символов) вместо полного совпадения

### 2. **Проблема с пустым названием танца**
- **Симптом**: Строки 16, 17 имеют пустое название танца (соло)
- **Причина**: Валидация требует `danceName`, но для соло оно может быть пустым
- **Решение**: Разрешить пустое `danceName` для соло или использовать имя участника как название

### 3. **Проблема синхронизации currentCategory**
- **Симптом**: `currentCategory` может быть не синхронизирован между параллельными промисами
- **Причина**: Используется `Promise.all` для параллельного парсинга, но `currentCategory` - общая переменная
- **Решение**: Парсить последовательно или использовать правильную синхронизацию

### 4. **Проблема парсинга категорий**
- **Симптом**: Дисциплины, номинации, возрасты не находятся
- **Причина**: 
  - "СТК" находится, но нужно проверить правильность маппинга
  - "Contemprorary" (опечатка) не находится как "Contemporary"
  - "Формейшн" должен находиться, но нужно проверить
- **Решение**: Улучшить парсинг и добавить больше вариантов

### 5. **Проблема с данными в колонках**
- **Симптом**: Некоторые данные могут быть обрезаны или неправильно прочитаны
- **Решение**: Улучшить чтение ячеек Excel

## План исправления

### Этап 1: Исправить определение строк категорий
1. Изменить логику определения: проверять первые 50-100 символов вместо полного совпадения
2. Или проверять начало строки (первые 20-30 символов) на совпадение
3. Учесть, что колонки могут быть обрезаны

### Этап 2: Исправить синхронизацию currentCategory
1. Изменить параллельный парсинг на последовательный
2. Или использовать правильную синхронизацию с мьютексом/очередью

### Этап 3: Улучшить парсинг категорий
1. Добавить больше аббревиатур и вариантов написания
2. Улучшить поиск "Contemprorary" → "Contemporary"
3. Проверить поиск "Формейшн"
4. Добавить логирование для отладки

### Этап 4: Исправить валидацию
1. Разрешить пустое `danceName` для соло
2. Использовать имя участника/коллектива как fallback

### Этап 5: Улучшить чтение данных
1. Правильно обрабатывать обрезанные ячейки
2. Улучшить чтение многострочных значений (ФИО на дипломы)

## Приоритет исправлений

1. **КРИТИЧНО**: Исправить определение строк категорий (Этап 1)
2. **КРИТИЧНО**: Исправить синхронизацию currentCategory (Этап 2)
3. **ВАЖНО**: Улучшить парсинг категорий (Этап 3)
4. **ВАЖНО**: Исправить валидацию (Этап 4)
5. **ЖЕЛАТЕЛЬНО**: Улучшить чтение данных (Этап 5)

## Тестирование

После каждого этапа нужно:
1. Протестировать на реальном файле `импорт.xlsx`
2. Проверить, что категории правильно определяются
3. Проверить, что все поля правильно парсятся
4. Проверить, что регистрации создаются без ошибок

