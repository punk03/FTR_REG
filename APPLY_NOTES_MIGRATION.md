# Применение миграции для добавления поля notes в регистрации

## ⚠️ ВАЖНО: Безопасное применение без потери данных

Если Prisma предлагает reset базы данных - **НЕ СОГЛАШАЙТЕСЬ!** Это удалит все данные.

## Описание
Добавлено поле `notes` (заметки) в модель `Registration`, которое позволяет добавлять заметки к каждому танцу. Эти заметки будут видны во всех меню, где отображаются регистрации:
- Список регистраций
- Объединенная оплата
- Дипломы
- Бухгалтерия

## Применение миграции (БЕЗОПАСНЫЕ СПОСОБЫ)

### ✅ Вариант 1: Ручное применение SQL (САМЫЙ БЕЗОПАСНЫЙ - РЕКОМЕНДУЕТСЯ)
Этот способ гарантированно сохранит все данные:

```bash
docker-compose exec postgres psql -U ftr_user -d ftr_db -c "ALTER TABLE \"Registration\" ADD COLUMN IF NOT EXISTS \"notes\" TEXT;"
```

После этого пометим миграцию как примененную:
```bash
docker-compose exec backend npx prisma migrate resolve --applied add_notes_to_registration --schema=prisma/schema.prisma 2>/dev/null || true
```

### ✅ Вариант 2: Использование db push (безопасно)
Синхронизирует схему без потери данных:

```bash
docker-compose exec backend npx prisma db push --schema=prisma/schema.prisma
```

### ⚠️ Вариант 3: Автоматическое создание миграции (только если нет drift)
Используйте только если Prisma не показывает предупреждение о drift:

```bash
docker-compose exec backend npx prisma migrate dev --name add_notes_to_registration --schema=prisma/schema.prisma
```

**Если Prisma предлагает reset - нажмите N (нет) и используйте Вариант 1!**

## Проверка применения миграции
После применения миграции проверьте, что поле добавлено:
```bash
docker-compose exec postgres psql -U ftr_user -d ftr_db -c "\d \"Registration\""
```

В списке колонок должно появиться поле `notes` типа `text`.

## Использование
1. При создании или редактировании регистрации в форме есть поле "Заметки к регистрации"
2. Заметки отображаются:
   - В таблице регистраций (колонка "Заметки")
   - В мобильных карточках регистраций
   - В развернутом блоке дипломов
   - В бухгалтерии рядом с информацией о регистрации

## Примечания
- Поле `notes` является опциональным (может быть `null`)
- Заметки сохраняются как обычный текст
- Заметки можно редактировать в любое время через форму редактирования регистрации

