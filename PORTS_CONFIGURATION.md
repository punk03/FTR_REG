# Конфигурация портов для доступа из внешней сети

## Порты, которые нужно пробросить на белый IP

### Обязательные порты:

1. **Порт 3000 (Frontend)** - **ОБЯЗАТЕЛЕН**
   - Это основной порт для доступа к веб-интерфейсу
   - Откройте этот порт на роутере/файрволе
   - Внешний доступ: `http://95.71.125.8:3000`

### Опциональные порты:

2. **Порт 3001 (Backend)** - **ОПЦИОНАЛЬНО**
   - Нужен только если frontend обращается к API напрямую через внешний IP
   - Если frontend использует nginx proxy (через `/api`), то этот порт НЕ нужен
   - Рекомендуется НЕ открывать этот порт для безопасности

## Порты, которые НЕ нужно открывать:

- **Порт 5432 (PostgreSQL)** - используется только внутри Docker сети
- **Порт 6379 (Redis)** - используется только внутри Docker сети

## Рекомендуемая конфигурация:

### Вариант 1: Только порт 3000 (рекомендуется)

**Настройка:**
1. Откройте только порт **3000** на роутере/файрволе
2. Убедитесь, что в `.env` файле или при сборке frontend:
   ```
   VITE_API_URL=http://95.71.125.8:3000
   ```
   Или используйте относительные пути (nginx proxy автоматически проксирует `/api` на backend)

**Преимущества:**
- Более безопасно (backend не доступен извне)
- Проще настройка (один порт)
- Все запросы идут через nginx proxy

### Вариант 2: Порты 3000 и 3001

**Настройка:**
1. Откройте порты **3000** и **3001** на роутере/файрволе
2. Убедитесь, что в `.env` файле:
   ```
   VITE_API_URL=http://95.71.125.8:3001
   ```

**Недостатки:**
- Backend доступен напрямую извне (менее безопасно)
- Нужно настраивать два порта

## Проверка конфигурации:

После настройки портов проверьте:

```bash
# Проверка доступности frontend
curl http://95.71.125.8:3000

# Проверка доступности backend (если открыт порт 3001)
curl http://95.71.125.8:3001/api/health
```

## Настройка файрвола (ufw) на сервере:

```bash
# Разрешить порт 3000
sudo ufw allow 3000/tcp

# Если нужен порт 3001 (не рекомендуется)
sudo ufw allow 3001/tcp

# Проверить статус
sudo ufw status
```

## Настройка роутера:

Если сервер находится за роутером, настройте проброс портов (Port Forwarding):

1. Зайдите в настройки роутера
2. Найдите раздел "Port Forwarding" или "Виртуальные серверы"
3. Добавьте правило:
   - **Внешний порт:** 3000
   - **Внутренний IP:** IP адрес сервера в локальной сети
   - **Внутренний порт:** 3000
   - **Протокол:** TCP

## Текущая конфигурация проекта:

- Frontend использует nginx proxy для запросов к `/api`
- Nginx автоматически проксирует запросы на `http://backend:3001` через внутреннюю Docker сеть
- Рекомендуется использовать только порт 3000

