# Руководство пользователя FTR Registration System

## Содержание

1. [Введение](#введение)
2. [Вход в систему](#вход-в-систему)
3. [Роли и права доступа](#роли-и-права-доступа)
4. [Управление регистрациями](#управление-регистрациями)
5. [Система оплат](#система-оплат)
6. [Бухгалтерия](#бухгалтерия)
7. [Дипломы и медали](#дипломы-и-медали)
8. [Статистика](#статистика)
9. [Админ-панель](#админ-панель)
10. [Экспорт данных](#экспорт-данных)
11. [Часто задаваемые вопросы](#часто-задаваемые-вопросы)

---

## Введение

FTR Registration System - это веб-приложение для автоматизации регистрации участников танцевальных мероприятий, управления оплатами, учета дипломов/медалей, бухгалтерского учета и статистики.

### Основные возможности

- Регистрация участников мероприятий
- Управление оплатами (выступления, дипломы, медали)
- Бухгалтерский учет с поддержкой откатов
- Управление дипломами и медалями
- Статистика и аналитика
- Импорт данных из Excel
- Экспорт данных в различных форматах

---

## Вход в систему

### Первый вход

1. Откройте страницу входа в систему
2. Введите email и пароль
3. Нажмите кнопку "Войти"

### Демо-аккаунты

Для тестирования системы доступны следующие демо-аккаунты:

- **Администратор**: `admin@ftr.ru` / `admin123`
- **Регистратор**: `registrar@ftr.ru` / `registrar123`
- **Бухгалтер**: `accountant@ftr.ru` / `accountant123`
- **Статистик**: `statistician@ftr.ru` / `statistician123`

### Выход из системы

Нажмите кнопку "Выход" в правом верхнем углу интерфейса.

---

## Роли и права доступа

### ADMIN (Администратор)
- Полный доступ ко всем функциям системы
- Управление пользователями
- Управление мероприятиями
- Управление системными настройками
- Удаление регистраций и записей бухгалтерии

### REGISTRATOR (Регистратор)
- Создание и редактирование регистраций
- Создание оплат
- Управление дипломами и медалями
- Отмена оплаты дипломов (в течение настроенного времени)

### ACCOUNTANT (Бухгалтер)
- Просмотр и редактирование записей бухгалтерии
- Управление откатами
- Просмотр статистики
- Экспорт данных

### STATISTICIAN (Статистик)
- Просмотр статистики
- Экспорт данных в различных форматах

---

## Управление регистрациями

### Создание регистрации

1. Перейдите на страницу "Регистрации"
2. Нажмите кнопку "Создать регистрацию"
3. Заполните многошаговую форму:

#### Шаг 1: Информация о коллективе
- Выберите мероприятие
- Введите название коллектива (или выберите из списка)
- Введите принадлежность (школа, студия и т.д.)
- Выберите руководителей (можно добавить новых)
- Выберите тренеров (можно добавить новых)

#### Шаг 2: Участники
- Выберите номинацию (Соло, Дуэт/Пара, Малая группа и т.д.)
- Введите количество участников
- Для Соло и Дуэта: выберите конкретных участников из списка
- Для остальных номинаций: количество участников вводится вручную

#### Шаг 3: Направление
- Выберите дисциплину
- Выберите номинацию
- Выберите возрастную категорию
- Выберите категорию (Beginners, Basic, Advanced) - если включено для мероприятия

#### Шаг 4: Информация о номере
- Введите название танца
- Введите длительность (формат MM:SS или HH:MM:SS)
- Введите URL видео (опционально)
- Введите URL песни (опционально)

#### Шаг 5: Соглашения
- Отметьте согласие на обработку персональных данных
- Отметьте согласие на публикацию (если требуется)

4. Нажмите "Сохранить"

### Редактирование регистрации

1. Найдите регистрацию в списке
2. Нажмите на строку для просмотра деталей
3. Нажмите кнопку "Редактировать"
4. Внесите изменения
5. Нажмите "Сохранить"

**Важно:** После оплаты регистрации редактирование ограничено. Можно изменять только:
- Количество участников
- Количество федеральных участников
- Количество медалей
- Список дипломов

### Черновики регистраций

Система автоматически сохраняет незавершенные формы как черновики. Вы можете:
- Продолжить заполнение черновика позже
- Удалить черновик
- Просмотреть список всех черновиков

### Поиск и фильтрация

На странице списка регистраций доступны:
- Поиск по всем полям (коллектив, название, дисциплина и т.д.)
- Фильтр по мероприятию
- Фильтр по статусу оплаты
- Сортировка по различным полям

---

## Система оплат

### Объединенная оплата

1. Перейдите на страницу "Объединенная оплата"
2. Выберите мероприятие
3. Выберите регистрации для оплаты (чекбоксы)
4. При необходимости отредактируйте данные регистраций:
   - Количество участников
   - Количество федеральных участников
   - Количество медалей
   - Список дипломов
5. Выберите что оплачиваем:
   - Выступления
   - Дипломы и медали
6. Если оплачиваете выступления, можете применить откат
7. Введите название группы платежей (опционально)
8. Распределите сумму по способам оплаты:
   - Наличные
   - Карта
   - Перевод
9. Проверьте предпросмотр сумм
10. Нажмите "Создать оплату"

### Расчет стоимости

Стоимость выступления рассчитывается по формуле:
- Обычные участники: `количество × цена за участника`
- Федеральные участники: `количество × цена за федерального участника` (или цена за обычного, если не указана)

Стоимость дипломов и медалей:
- Дипломы: `количество × цена за диплом`
- Медали: `количество × цена за медаль`

### Откаты

Откаты применяются только к выступлениям и рассчитываются от общей суммы всех выступлений в группе платежей по уровням откатов, настроенным для мероприятия.

---

## Бухгалтерия

### Просмотр записей

1. Перейдите на страницу "Бухгалтерия"
2. Выберите мероприятие
3. Просмотрите сводную информацию:
   - Итого получено (до откатов)
   - После откатов
   - Выданные откаты
   - Детализация по способам оплаты

### Объединенные платежи

Записи с одинаковым `paymentGroupId` группируются вместе. Для каждой группы отображается:
- Название группы
- Общая сумма
- Сумма отката
- Детализация по записям

Вы можете:
- Редактировать название группы
- Применить откат к группе
- Развернуть/свернуть детализацию

### Одиночные платежи

Платежи без группы отображаются отдельно, разделены на:
- Одиночные выступления
- Одиночные дипломы/медали

### Редактирование записи

1. Нажмите кнопку "Редактировать" у записи
2. Измените необходимые поля:
   - Сумма
   - Способ оплаты
   - За что оплачено (выступление/дипломы-медали)
   - Откат (только для выступлений)
3. Нажмите "Сохранить"

### Удаление и восстановление

- **Удаление:** Запись помечается как удаленная (soft delete), но не удаляется физически
- **Восстановление:** Администратор может восстановить удаленную запись

---

## Дипломы и медали

### Просмотр списка

1. Перейдите на страницу "Дипломы и медали"
2. Выберите мероприятие
3. Используйте фильтры:
   - Показать/скрыть оплаченные
   - Показать/скрыть неоплаченные
   - Показать/скрыть распечатанные
   - Показать/скрыть удаленные

### Редактирование списка дипломов

1. Нажмите кнопку "Редактировать" у регистрации
2. Введите список ФИО для дипломов (каждое ФИО с новой строки)
3. Введите количество медалей
4. Количество дипломов рассчитывается автоматически из списка
5. Нажмите "Сохранить"

### Массовая оплата

1. Выберите регистрации (чекбоксы)
2. Нажмите "Оплатить выбранные"
3. Распределите сумму по способам оплаты
4. Нажмите "Оплатить"

### Отмена оплаты

- **REGISTRATOR:** Можно отменить оплату только в течение настроенного времени (по умолчанию 5 минут)
- **ADMIN:** Можно отменить оплату в любое время

### Отметка печати

- Отметьте одну или несколько регистраций
- Нажмите "Отметить как распечатанные"
- Или используйте массовую операцию

---

## Статистика

### Просмотр статистики

1. Перейдите на страницу "Статистика"
2. Выберите мероприятие
3. Просмотрите:
   - Общую статистику (регистрации, коллективы, участники, дипломы, медали)
   - Статистику по номинациям (круговая диаграмма)
   - Статистику по статусам оплат (круговая диаграмма)
   - Статистику по дисциплинам (столбчатая диаграмма)
   - Статистику по возрастам (столбчатая диаграмма)

### Обновление статистики

Статистика обновляется автоматически каждые 30 секунд. Вы также можете обновить её вручную, нажав кнопку обновления.

### Экспорт статистики

Доступны следующие форматы экспорта:
- **Excel** (.xlsx) - для работы в Excel
- **CSV** (.csv) - для импорта в другие системы
- **PDF** (.pdf) - для печати и архива

---

## Админ-панель

### Управление пользователями

1. Перейдите в "Админ-панель" → "Пользователи"
2. Просмотрите список всех пользователей
3. Создайте нового пользователя:
   - Нажмите "Создать пользователя"
   - Заполните форму (имя, email, пароль, роль, город, телефон)
   - Нажмите "Сохранить"
4. Редактируйте пользователя:
   - Нажмите "Редактировать" у пользователя
   - Внесите изменения
   - Нажмите "Сохранить"
5. Удалите пользователя:
   - Нажмите "Удалить" у пользователя
   - Подтвердите удаление

**Ограничения:**
- Администратор не может удалить себя
- В системе должен остаться хотя бы один администратор

### Управление мероприятиями

1. Перейдите в "Админ-панель" → "Мероприятия"
2. Просмотрите список мероприятий
3. Создайте новое мероприятие:
   - Нажмите "Создать мероприятие"
   - Заполните форму:
     - Основная информация: название, описание, даты, статус
     - Настройки: онлайн, оплаты, категории, песни, длительность
     - Цены: цены на дипломы/медали, цены по номинациям
     - Откаты: настройте уровни откатов
   - Нажмите "Сохранить"
4. Дублируйте мероприятие:
   - Нажмите "Дублировать" у мероприятия
   - Введите название нового мероприятия
   - Выберите, копировать ли регистрации
   - Нажмите "Создать"
5. Удалите все регистрации мероприятия:
   - Нажмите "Удалить все регистрации"
   - Подтвердите удаление
6. Удалите мероприятие:
   - Можно удалить только если нет регистраций
   - Используйте архивирование (статус ARCHIVED) для скрытия мероприятия

### Управление коллективами и персонами

В разделе "Админ-панель" доступно управление:
- Коллективами: просмотр списка, удаление
- Персонами (руководители/тренеры): просмотр списка, удаление

### Системные настройки

1. Перейдите в "Админ-панель" → "Системные настройки"
2. Просмотрите список настроек
3. Редактируйте настройку:
   - Нажмите "Редактировать" у настройки
   - Введите новое значение
   - Нажмите "Сохранить"

**Важные настройки:**
- Время отмены оплаты дипломов (в минутах) - для ограничения отмены оплаты регистраторами

---

## Экспорт данных

### Экспорт бухгалтерии

На странице "Бухгалтерия" доступны следующие форматы:
- **Excel** (.xlsx) - детальная таблица всех записей
- **CSV** (.csv) - для импорта в другие системы
- **PDF** (.pdf) - форматированный отчет с сводной информацией

### Экспорт статистики

На странице "Статистика" доступны:
- **Excel** (.xlsx) - таблица со всеми данными регистраций
- **CSV** (.csv) - для импорта в другие системы
- **PDF** (.pdf) - форматированный отчет со статистикой

### Импорт из Excel

1. Перейдите в "Админ-панель" → "Импорт Excel"
2. Выберите мероприятие
3. Загрузите Excel файл
4. Просмотрите предпросмотр данных
5. Выберите режим импорта:
   - Dry run (предпросмотр) - только просмотр без сохранения
   - Реальный импорт - создание регистраций
6. Выберите режим удаления (если требуется)
7. Нажмите "Импортировать"
8. Просмотрите отчет об ошибках (если есть)

**Формат Excel файла:**
- Колонка A: номер/категория
- Колонка B: коллектив
- Колонка C: название танца
- Колонка D: количество участников
- Колонка E: руководители
- Колонка F: тренеры
- Колонка G: школа
- Колонка H: контакты
- Колонка I: город
- Колонка J: длительность
- Колонка K: видео URL
- Колонка L: ФИО на дипломы
- Колонка M: количество медалей

---

## Часто задаваемые вопросы

### Как создать регистрацию?

Перейдите на страницу "Регистрации" → "Создать регистрацию" и заполните многошаговую форму.

### Как оплатить несколько регистраций одновременно?

Используйте страницу "Объединенная оплата". Выберите регистрации и создайте групповой платеж.

### Как применить откат?

Откаты применяются автоматически при создании объединенной оплаты, если отмечен чекбокс "Применить откат". Откат рассчитывается от общей суммы всех выступлений в группе.

### Как отменить оплату дипломов?

На странице "Дипломы и медали" нажмите "Отменить оплату" у регистрации. Регистраторы могут отменить оплату только в течение настроенного времени (по умолчанию 5 минут), администраторы - в любое время.

### Как экспортировать данные?

На страницах "Бухгалтерия" и "Статистика" доступны кнопки экспорта в Excel, CSV и PDF форматах.

### Как импортировать данные из Excel?

Перейдите в "Админ-панель" → "Импорт Excel", выберите мероприятие, загрузите файл и следуйте инструкциям.

### Что делать, если забыл пароль?

Обратитесь к администратору системы для сброса пароля.

### Как изменить данные регистрации после оплаты?

После оплаты можно редактировать только ограниченный набор полей: количество участников, федеральных участников, медалей и список дипломов. Для других изменений обратитесь к администратору.

### Как удалить регистрацию?

Удаление регистраций доступно только администраторам. Найдите регистрацию, откройте детали и нажмите "Удалить".

### Как работает автосохранение черновиков?

Система автоматически сохраняет незавершенные формы регистраций как черновики. Вы можете продолжить заполнение позже из списка черновиков.

### Как обновить статистику вручную?

На странице "Статистика" нажмите кнопку обновления (иконка обновления). Статистика также обновляется автоматически каждые 30 секунд.

---

## Поддержка

При возникновении вопросов или проблем обращайтесь к администратору системы.

**Версия документа:** 1.0  
**Дата обновления:** 2025


